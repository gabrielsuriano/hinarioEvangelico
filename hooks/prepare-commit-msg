#!/bin/sh

# Hook: prepare-commit-msg
# Executado APÃ“S a mensagem do commit ser escrita
# Atualiza a versÃ£o automaticamente baseado em tags no commit

COMMIT_MSG_FILE=$1
COMMIT_SOURCE=$2

# SÃ³ executar para commits normais (nÃ£o merges, squashes, etc)
if [ -z "$COMMIT_SOURCE" ] || [ "$COMMIT_SOURCE" = "message" ]; then
  echo "ðŸ”„ Verificando versionamento automÃ¡tico..."
  node scripts/auto-version.js "$COMMIT_MSG_FILE"
  
  if [ $? -ne 0 ]; then
    echo "âŒ Erro no versionamento automÃ¡tico"
    exit 1
  fi
  
  # Adiciona package.json ao commit
  git add package.json 2>/dev/null || true
fi

exit 0
